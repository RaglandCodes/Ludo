<html>
  <head>
    <title>Ludo</title>
  </head>
  <div id="game-space"></div>
  <body>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/4.8.7/pixi.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/socket.io/2.2.0/socket.io.dev.js"></script>

    <script>
      const gameSpace = document.getElementById("game-space");
      let socket = io.connect("http://localhost:5656");
      let myId = "a";
      let myTurn = false;
      let currentPlayer = "❓";
      let diceNumber = 0;

      socket.on("id", id => {
        myId = id.id;
        console.log(myId);
      });

      socket.on("reRender", data => {
        console.log(data);

        gameSpace.innerHTML = "";
        let numberOfPlayers = data.players.length;
        let app = new PIXI.Application({
          width: 500,
          height: 700
        });

        gameSpace.appendChild(app.view);

        const boardTexture = PIXI.Texture.from(
          "https://raw.githubusercontent.com/RaglandCodes/Ludo/master/public/board.png"
        );
        const boardImg = new PIXI.Sprite(boardTexture);
        boardImg.height = 500;
        boardImg.width = 500;
        app.stage.addChild(boardImg);

        let graphics = new PIXI.Graphics();
        graphics.beginFill(0xde3249);
        graphics.drawRect(0, 500, 500, 45);
        graphics.endFill();
        app.stage.addChild(graphics);

        graphics.beginFill(0xdef245);
        graphics.drawRect(0, 545, 500, 45);
        graphics.endFill();
        app.stage.addChild(graphics);

        // drawing the dice
        graphics.beginFill(0xffffff);
        graphics.drawRect(300, 546, 50, 40);
        graphics.endFill();
        app.stage.addChild(graphics);

        // //drawing game pieces
        //         graphics.lineStyle(2, 0x76FF03, 1);
        //         graphics.beginFill(0xDD2C00, 1);
        //         graphics.drawCircle(400, 65, 10);
        //         graphics.endFill();

        //         graphics.lineStyle(2, 0x76FF03, 1);
        //         graphics.beginFill(0xDD2C00, 1);
        //         graphics.drawCircle(400, 135, 10);
        //         graphics.endFill();

        //         graphics.lineStyle(2, 0x76FF03, 1);
        //         graphics.beginFill(0xDD2C00, 1);
        //         graphics.drawCircle(365, 100, 10);
        //         graphics.endFill();

        //         graphics.lineStyle(2, 0x76FF03, 1);
        //         graphics.beginFill(0xDD2C00, 1);
        //         graphics.drawCircle(435, 100, 10);
        //         graphics.endFill();
        // //--- grn
        //         graphics.lineStyle(2, 0x76FF03, 1);
        //         graphics.beginFill(0xDD2C00, 1);
        //         graphics.drawCircle(400, 435, 10);
        //         graphics.endFill();

        //         graphics.lineStyle(2, 0x76FF03, 1);
        //         graphics.beginFill(0xDD2C00, 1);
        //         graphics.drawCircle(400, 365, 10);
        //         graphics.endFill();

        //         graphics.lineStyle(2, 0x76FF03, 1);
        //         graphics.beginFill(0xDD2C00, 1);
        //         graphics.drawCircle(365, 400, 10);
        //         graphics.endFill();

        //         graphics.lineStyle(2, 0x76FF03, 1);
        //         graphics.beginFill(0xDD2C00, 1);
        //         graphics.drawCircle(435, 400, 10);
        //         graphics.endFill();

        const colours = {
          green: "0x1B5E20",
          red: "0xDD2C00",
          blue: "0x1A237E",
          yellow: "0xFFA000",
        }
        for (const piece of data.pieceData) {
          graphics.lineStyle(2, 0x76ff03, 1);
          graphics.beginFill(colours[`${piece['colour']}`], 1);
          graphics.drawCircle(piece.locationX, piece.locationY, 10);
          graphics.endFill();
        }

        let diceText = new PIXI.Text(`${diceNumber}`, {
          fontSize: 20,
          fontWeight: "bold",
          fill: ["#000001"]
        });
        diceText.x = 330;
        diceText.y = 548;
        app.stage.addChild(diceText);

        socket.on("turn", turn => {
          if (turn.turn == myId) {
            myTurn = true;
          }
          currentPlayer = turn.colour;
          console.log(turn);
          diceNumber = turn.diceState;
        });

        let diceBtn = new PIXI.Graphics();
        diceBtn.beginFill(0xdf3219);
        diceBtn.drawRect(385, 548, 100, 40);
        diceBtn.endFill();
        diceBtn.buttonMode = true;
        diceBtn.interactive = true;

        diceBtn.on("pointerdown", () => {
          if (myTurn) {
            socket.emit("diceRoll");
            myTurn = false;
          } else alert("Not your turn");
        });

        app.stage.addChild(diceBtn);

        let diceBtnText = new PIXI.Text("Roll Dice", {
          fontSize: 20,
          fontWeight: "bold",
          fill: ["#2e4fe1"]
        });

        diceBtnText.x = 390;
        diceBtnText.y = 551;

        app.stage.addChild(diceBtnText);

        let diceTurnText = new PIXI.Text(`Now it's ${currentPlayer}'s turn`, {
          fontSize: 20,
          fontWeight: "bold",
          fill: ["#2e4fe1"]
        });
        diceTurnText.x = 50;
        diceTurnText.y = 551;
        app.stage.addChild(diceTurnText);

        let style = new PIXI.TextStyle({
          fontFamily: "Arial",
          fontSize: 23,
          fontWeight: "bold",
          fill: ["#ffffff"],
          stroke: "#4a1850",
          strokeThickness: 3,
          wordWrap: true,
          wordWrapWidth: 480
        });
        let richText = "";
        if (numberOfPlayers < 4) {
          richText = new PIXI.Text(
            `There are ${numberOfPlayers} players. Waiting for 4 players.`,
            style
          );
        } else if (numberOfPlayers == 4) {
          let myColour = data.players.filter(player => player["id"] == myId)[0][
            "colour"
          ];

          richText = new PIXI.Text(`You are ${myColour} colour.`, style);
        }
        richText.x = 10;
        richText.y = 505;

        app.stage.addChild(richText);
      });
    </script>
  </body>
</html>
